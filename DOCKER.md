# üê≥ Docker Guide

This document explains how to build, run, and configure the Bitcoin Node Dashboard using Docker.

## Pre-built Images

Official images are available on GitHub Packages:
https://github.com/comassky/btc-node-dashboard/pkgs/container/btc-node-dashboard

### Run Native Image (Recommended)

```bash
docker run -d -p 8080:8080 \
  -e RPC_HOST=<HOST> \
  -e RPC_PORT=<PORT> \
  -e RPC_USER=<USER> \
  -e RPC_PASS=<PASSWORD> \
  -e WS_POLLING_INTERVAL=5 \
  -e MIN_OUTBOUND_PEERS=8 \
  -e LOG_LEVEL=INFO \
  -e DASHBOARD_CACHE_VALIDITY_BUFFER_MS=200 \
  ghcr.io/comassky/btc-node-dashboard:native
```

### Run JVM Image

```bash
docker run -d -p 8080:8080 \
  -e RPC_HOST=<HOST> \
  -e RPC_PORT=<PORT> \
  -e RPC_USER=<USER> \
  -e RPC_PASS=<PASSWORD> \
  -e WS_POLLING_INTERVAL=5 \
  -e MIN_OUTBOUND_PEERS=8 \
  -e LOG_LEVEL=INFO \
  -e DASHBOARD_CACHE_VALIDITY_BUFFER_MS=200 \
  ghcr.io/comassky/btc-node-dashboard:main
```

## Docker Compose

See [compose.yml](compose.yml) for a full setup with Bitcoin Core.

## Configuration

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `BITCOIN_RPC_HOST` | `127.0.0.1` | Bitcoin node hostname or IP address |
| `QUARKUS_IO_THREADS` | `8` | Number of IO threads for backend concurrency (recommended: 2 √ó number of CPU cores). Example: `QUARKUS_IO_THREADS=16` |
| `BITCOIN_RPC_PORT` | `8332` | Bitcoin RPC port |
| `BITCOIN_RPC_USER` | - | RPC username for authentication |
| `BITCOIN_RPC_PASSWORD` | - | RPC password for authentication |
| `BITCOIN_RPC_SCHEME` | `http` | RPC protocol (`http` or `https`) |
| `WS_POLLING_INTERVAL` | `5` | Dashboard polling interval in seconds |
| `MIN_OUTBOUND_PEERS` | `8` | Minimum number of outbound peers for dashboard health |
| `DASHBOARD_CACHE_VALIDITY_BUFFER_MS` | `200` | Cache validity buffer in ms for dashboard cache |
| `DASHBOARD_SESSIONS_MAX` | `1000` | Maximum number of dashboard sessions |
| `DASHBOARD_CACHE_MAX_ITEMS` | `50` | Maximum number of items in dashboard cache |
| `DASHBOARD_DISABLE_MEMPOOL` | `false` | Set to `true` to disable mempool info retrieval in the dashboard |
| `LOG_LEVEL` | `INFO` | Application log level (`TRACE`, `DEBUG`, `INFO`, `WARN`, `ERROR`). Use `DEBUG` to see detailed startup configuration |

### Application Properties

As an alternative to environment variables, create `src/main/resources/application-local.properties`:

```properties
bitcoin.rpc.scheme=http
bitcoin.rpc.host=localhost
bitcoin.rpc.port=8332
bitcoin.rpc.user=your_rpc_username
bitcoin.rpc.password=your_rpc_password
dashboard.polling.interval.seconds=5
dashboard.cache.validity.buffer.ms=200
```

## Available Image Tags

The project publishes pre-built images to GitHub Container Registry. The following tags are produced by the repository's GitHub Actions workflows and indicate the build variant and versioning semantics:

- **`jvm`**: a JVM-based image built from the `main` branch. Use this when running the standard Java runtime image.
- **`jvm-<version>` / `jvm-<major>.<minor>` / `jvm-<major>`**: semantic-version tags for the JVM image derived from git tags (example: `jvm-1.2.3`, `jvm-1.2`, `jvm-1`).
- **`latest`**: for the native (GraalVM) image produced from `main`; enabled only when building from `main`.
- **`<version>` / `<major>.<minor>` / `<major>`**: semantic-version tags for the native (GraalVM) image derived from git tags (example: `1.2.3`, `1.2`, `1`).
- **`native`** (implicit): historically used local tag name for the native image. The develop workflow also publishes a `develop` tag for images built from the `develop` branch.
- **`develop`**: images built from the `develop` branch (native/GraalVM workflow).

Examples:

```bash
docker pull ghcr.io/comassky/btc-node-dashboard:jvm-1.4.0-SNAPSHOT
docker pull ghcr.io/comassky/btc-node-dashboard:1.4.0-SNAPSHOT
docker pull ghcr.io/comassky/btc-node-dashboard:develop
```

Notes:

- Tags are generated by the GitHub Actions `docker/metadata-action` configuration inside `.github/workflows/`.
- JVM images are tagged with a `jvm` prefix by the `docker.yml` workflow.
- Native (GraalVM) images are produced by `docker-native.yml` and `docker-dev-native.yml`; the develop workflow adds a `develop` tag while the main workflow produces `latest` and semver tags when building from git tags.


